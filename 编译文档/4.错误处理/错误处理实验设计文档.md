### 错误处理实验设计文档

> 18373441
>
> 覃启浩

#### 题目要求

​		据给定的文法设计并实现错误处理程序，能诊察出常见的语法和语义错误，进行错误局部化处理，并输出错误信息。

#### 设计思路

##### 建立符号表

​		在编译原理课上，我学习到了错误处理和符号表的相关知识，在经过一段时间思考之后，我对于这次实验的完成有了大致思路。

​		首先是**建立符号表**，这是最基本和最重要的。有了符号表，就可以存取各种变量和函数的信息，就可以判断根据符号表中的信息判断是否有错误了。我把符号表分为全局符号表（包括全局变量和函数）以及局部符号表（包括局部变量），还有一个函数的参数表，开始我以为会出现多层结构的，后面经过分析之后发现局部变量只会有一层，那就只用建立一个局部符号表就够了。

​		初次分析的时候，我认为符号表中存的数据应当包含如下信息：

* 变量名及其类型

* 常量名及其类型

* 函数的参数个数以及类型

* 函数名及是否有返回值

* 数组的名字及其维数

  可以把符号表中的数据分为四种类型：变量，常量，函数，数组

##### 分类解决错误

​		在大致理清思路之后，我开始着手解决题目要求了。

​		我首先将所以的错误分类，从简单到复杂，一步步解决问题：

| 难度和复杂程度             | 错误类型                                                     |
| -------------------------- | ------------------------------------------------------------ |
| 无脑简单                   | 缺少分号<br />缺少括号<br />缺少缺省                         |
| 比较简单，基本不需要符号表 | 非法符号<br />函数是否有返回<br />数组初始化个数<br />条件判断 |
| 需要涉及符号表             | 剩余                                                         |



#### 重点难点

​		**架构的确立**。这个架构指的是用什么来完成实验，是用类还是用结构体，是用全局变量还是用函数传递参数，错误处理的那些函数和定义声明应该放在哪些地方，这些问题都确实困扰到了我。

符号表的建立。应该有哪些符号表，符号表中存哪一些数据，仔细分析之后我用结构体存储符号表中的一个元素，同时用hashmap建立名字到符号表结构体的索引。

​		如何**具体解决每一种错误类型**。每一种错误类型的解决办法是不一样的，比如空的字符或者非法字符这类错误就需要在词法分析读取字符或字符串时就发现，而缺少分号这种类型就是在语法分析时简单地判断symbol是否是分号就行了，而函数的参数类型和个数是否满足则需要查找建立的符号表来判断是否有错误，这些不同类型的错误分布在语法分析的各种地方，这些情况不是统一的，它们有时候让我头绪混乱。

​		**修改原有代码**。在有错误处理的情况下，由于错误的存在，我们需要对语法分析甚至是词法分析代码进行修改，比如预读可能需要调整，很多分析子程序的函数类型可能需要从void变为int等类型，不同函数之间可能需要借用全局变量或者传递参数，比如表达式、项、因子需要有返回类型来判断是int类型还是char类型。这还是花费了我不少的精力。

​		**debug**。我个人是没有太多的bug的，在群友的帮助下，我比较轻松的解决了一个80%的问题，而有些人就头疼了好久，如果没有大家的帮助，如何构建测试数据以及如何找出存在的bug绝对是个不小的挑战。

#### 不足之处

​		**架构不好**。我总觉得我的代码架构设计有很多不好的地方，或者说写得不够规范，比如说全局变量的泛滥，比如大括号有时候有有时候无，比如说存在很多冗余无用效率低的代码，这些我觉得可能都是可以改进的，但是我不知道怎样才是最规范的，目前来说，完成实验已经很好了。

#### 总结

​		这次实验花的时间跟语法分析基本一样，这其实说明了我效率有点低下，喜欢在学习的时候分心。总的来说，我比较成功地完成了这次实验，后面的日子，加油吧。